name: windows/initialize_build
description: 'Initializes the build environment'
inputs:
  configuration:
    description: 'The configuration (Debug, Release, etc.) to build.'
    required: true
runs:
  using: 'composite'
  steps:
    - name: Set MSBuild path
      run: >
        Write-Output
        'PRINCIPIA_MSBUILD_PATH="C:/Program Files/Microsoft Visual Studio/2022/Enterprise/MSBuild/Current/Bin/MSBuild.exe"'
        >> $env:GITHUB_ENV
      shell: pwsh
    - name: Set build signature path
      run: |
        $build_signature = New-TemporaryFile
        Write-Output "PRINCIPIA_BUILD_SIGNATURE_PATH=$build_signature" >> $env:GITHUB_ENV
      shell: pwsh
    - name: Append git SHA to signature
      run: |
        Write-Output ${{ git.sha }} >> ${{ env.PRINCIPIA_BUILD_SIGNATURE_PATH }}
      shell: pwsh
    - name: Append MSBuild version to signature
      run: |
        &"${{ env.PRINCIPIA_MSBUILD_PATH }}" -version >> ${{ env.PRINCIPIA_BUILD_SIGNATURE_PATH }}
      shell: pwsh
    - name: Append configuration to signature
      run: |
        Write-Output ${{ inputs.configuration }} >> ${{ env.PRINCIPIA_BUILD_SIGNATURE_PATH }}
      shell: pwsh
        
